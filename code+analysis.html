<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

<link rel="shortcut icon" href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa86755d1-d7c0-4214-9969-10bd17723e6b%2F14c9161b-ac22-44b3-ba34-fe5ad1169d1d.jpeg?table=collection&amp;id=eef6132e-2db7-4d90-bd95-b8ae4e7a15ec">

<!-- <style>
  :root {
    font-size: 20px;
  }
</style> -->
  <title>Dependency Management: Typescript Code Analysis &nbsp;|&nbsp;Lilian Jiangâ€™s Blog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="Dependency Management: Typescript Code Analysis ">
  
  <meta name="description" content="analyze the changed code, and scan the referenced files to analyze where they are used.">
  <meta property="og:description" content="analyze the changed code, and scan the referenced files to analyze where they are used.">
  
  
  <meta property="og:image" content="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ðŸ“ˆ&lt;/text&gt;&lt;/svg&gt;">
  
  <style>
    html {
      font-size: 18px;
    }

    @media (max-width: 768px) {
      html {
        font-size: 15px;
      }
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }

    .utterances {
      position: relative;
      box-sizing: border-box;
      width: 100%;
      max-width: 1100px;
      margin-left: auto;
      margin-right: auto;
    }

    .utterances-frame {
      color-scheme: light;
      position: absolute;
      left: 0;
      right: 0;
      width: 1px;
      min-width: 100%;
      max-width: 100%;
      height: 100%;
      border: 0;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa86755d1-d7c0-4214-9969-10bd17723e6b%2F14c9161b-ac22-44b3-ba34-fe5ad1169d1d.jpeg?table=collection&amp;id=eef6132e-2db7-4d90-bd95-b8ae4e7a15ec"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
      <span class="Navbar__Delim"> | </span>
      <a href="tags.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ðŸ“­&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>category</span>
        </div>
      </a>
    
  
    
      <span class="Navbar__Delim"> | </span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ðŸ˜„&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <div class="Header__Icon">
      <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ðŸ“ˆ&lt;/text&gt;&lt;/svg&gt;"></span>
    </div>
    
    <h1 class="Header__Title">Dependency Management: Typescript Code Analysis </h1>
    
    <div class="DateTagBar">
      
      <span class="DateTagBar__Item DateTagBar__Date">Posted on Fri, Mar 24, 2023</span>
      
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--brown">
        <a href="tag/AST.html">AST</a>
      </span>
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--red">
        <a href="tag/typescript.html">typescript</a>
      </span>
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--blue">
        <a href="tag/Node.html">Node</a>
      </span>
      
      <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
        <a href="tag/cli.html">cli</a>
      </span>
      
    </div>
    
  </header>
  <article id="https://www.notion.so/9afbfcf89808429088955f381d026302" class="PageRoot PageRoot--FullWidth"><h1 id="https://www.notion.so/81881694d2274eb2b59e58b6817dd4d9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/81881694d2274eb2b59e58b6817dd4d9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Introduction</span></span></h1><h3 id="https://www.notion.so/94d3642e53de46b788764ccca7d23fd0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/94d3642e53de46b788764ccca7d23fd0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Background Information</span></span></h3><div id="https://www.notion.so/a39bf58fc1f0482c829d20c4712661cc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">During the development process, it is common to modify shared code. for a simple modification, the impact can usually be manually controlled. However, if a large number of modifications are made at once or if this code is widely referenced in the project, it is difficult to determine its impact range through manual control or by using VSCode&#x27;s search function. Therefore, a code analysis tool is needed.</span></span></p></div><h3 id="https://www.notion.so/22204a8700c4408cbbbaa70ef75f869e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/22204a8700c4408cbbbaa70ef75f869e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Implementation </span></span></h3><div id="https://www.notion.so/962ecdd2e89f4730bfa4ffcf6af4f673" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">config</em></span></span></p></div><div id="https://www.notion.so/719c3b7a52504f5d8e477fe354a8209e" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb0903cb3-e69d-4280-9e5c-c8a89644f9b8%2FUntitled.png?width=424&amp;table=block&amp;id=719c3b7a-5250-4f5d-8e47-7fe354a8209e"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb0903cb3-e69d-4280-9e5c-c8a89644f9b8%2FUntitled.png?width=424&amp;table=block&amp;id=719c3b7a-5250-4f5d-8e47-7fe354a8209e" style="width:424px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/e22e487cd82c457caa8d940213c5d329" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">for example, as the simple demo shows in project, if we changed [Person, Address] in shared file (IMPORT_FILE_PATH),  in project we imported and used [Person, Address] from shared dir, we need to scan all the places where used these two changes, and output the report (as below)</span></span></p></div><div id="https://www.notion.so/9dea6be29c02427299467e3800f13dd6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">output</em></span></span></p></div><div id="https://www.notion.so/3a526eb08fe244f98d1f7ba95b32e0d7" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe7784318-c264-42cd-b093-fa6c9754372f%2FUntitled.png?width=528&amp;table=block&amp;id=3a526eb0-8fe2-44f9-8d1f-7ba95b32e0d7"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe7784318-c264-42cd-b093-fa6c9754372f%2FUntitled.png?width=528&amp;table=block&amp;id=3a526eb0-8fe2-44f9-8d1f-7ba95b32e0d7" style="width:528px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/89b42942104d410eb6404299182b547a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The general idea is to use </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">git diff</code></span><span class="SemanticString"> to obtain the modified code blocks, analyze the changed code through AST, and finally scan the referenced files to analyze where they are used.</span></span></p></div><h1 id="https://www.notion.so/540578b98ed846958ebff337eb51ac3b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/540578b98ed846958ebff337eb51ac3b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Prerequisites</span></span></h1><h2 id="https://www.notion.so/66b49ff0367c4af6a82c26e3c486c236" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/66b49ff0367c4af6a82c26e3c486c236"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Tools For Node CLI</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/387f01c4e69f4c12a68f7fb4cf8b869b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">program</code></span><span class="SemanticString">: a library for building command-line interfaces with Node.js</span></span></li><li id="https://www.notion.so/3c08f5164fa94ff6ac011dfd83af774a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">chalk</code></span><span class="SemanticString">: a library to stylize terminal output with colors and formatting</span></span></li><li id="https://www.notion.so/4c76e6f4f07849c594fc92c6d64836ef" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">ora</code></span><span class="SemanticString">: a library to create elegant terminal spinners</span></span></li><li id="https://www.notion.so/e0e2897bef2543ea9c88b571c27797c8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">progress</code></span><span class="SemanticString">: a library to show a progress bar in the terminal</span></span></li></ul><div id="https://www.notion.so/a7a964da1f9242ce8c08fe8ba176a44c" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F79c17109-0f1d-4ef3-9d64-a53294e5e12d%2FUntitled.png?width=528&amp;table=block&amp;id=a7a964da-1f92-42ce-8c08-fe8ba176a44c"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F79c17109-0f1d-4ef3-9d64-a53294e5e12d%2FUntitled.png?width=528&amp;table=block&amp;id=a7a964da-1f92-42ce-8c08-fe8ba176a44c" style="width:528px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/bbae50a5960243dcbb4951e71fb6c3cb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/bbae50a5960243dcbb4951e71fb6c3cb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">About AST</span></span></h2><div id="https://www.notion.so/fb7ea2e07ef244cc8683f167bdc1f721" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">AST, or Abstract Syntax Tree, is an abstract representation of the syntax structure of source code. In frontend development, AST can help us with code analysis, code transformation, code optimization, and other operations. It can structure the source code and help us analyze the statements inside the source code.</span></span></p></div><h3 id="https://www.notion.so/08218fd659fe4bf29e5f512d18fa0c2b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/08218fd659fe4bf29e5f512d18fa0c2b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">AST Structure</span></span></h3><div id="https://www.notion.so/a3201f83008a4d5f8545f9d660e662a7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here is an example of a TypeScript file being transformed into an AST: </span></span></p><div class="Text__Children"><div id="https://www.notion.so/fdfcab4445014cf38ee86942858187f4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">AST visualization: </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://ts-ast-viewer.com/">https://ts-ast-viewer.com/</a></span></span></p></div><div id="https://www.notion.so/3ed2f78dbbb140f084b3d128299c9a34" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">It is able to structure the source code and help us analyze the statements within the source code.</span></span></p></div><div id="https://www.notion.so/cac454a0c75344929497e29cfcbde748" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Understanding common node types is important</span></span></p></div><div id="https://www.notion.so/29366ca38ef043aeb56221fe62135241" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Resource"><a href="https://www.notion.so/c34d7ee198ab481899650367699925b0"><span class="SemanticStringArray"><span class="SemanticString">About AST: Common Node Types</span></span></a></span></span><span class="SemanticString"> </span></span></p></div></div></div><div id="https://www.notion.so/4d19cc1c941b42988af2e29c675a2f58" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fec8fcb09-2097-4796-8631-7f479d0f7423%2FUntitled.png?width=1104&amp;table=block&amp;id=4d19cc1c-941b-4298-8af2-e29c675a2f58"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fec8fcb09-2097-4796-8631-7f479d0f7423%2FUntitled.png?width=1104&amp;table=block&amp;id=4d19cc1c-941b-4298-8af2-e29c675a2f58" style="width:1104px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h3 id="https://www.notion.so/70f3751b0f554a8a9f8f5c79fd200552" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/70f3751b0f554a8a9f8f5c79fd200552"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">AST parse</strong></span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/1c50faa5e59149a3999bb1673d92736b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">ts-morph: a library to manipulate TypeScript ASTs programmatically</span></span></li></ul><div id="https://www.notion.so/a7a3748c508741cd913b474d907db401" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Here is an example of how to traverse and modify the AST (Abstract Syntax Tree) using TS-Morph:</span></span></p></div><pre id="https://www.notion.so/017940780adc4358b8c9c50d5a6858a1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">const</span> <span class="token punctuation">{</span> Project<span class="token punctuation">,</span> SyntaxKind <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"ts-morph"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> project <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Project</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sourceFile <span class="token operator">=</span> project<span class="token punctuation">.</span><span class="token function">addSourceFileAtPath</span><span class="token punctuation">(</span><span class="token string">"src/index.ts"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Traverse the AST and find all variable declarations</span>
sourceFile<span class="token punctuation">.</span><span class="token function">forEachDescendant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">getKind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> SyntaxKind<span class="token punctuation">.</span>VariableDeclaration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Modify the variable name</span>
    <span class="token keyword">const</span> variableName <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    node<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>variableName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Modified</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Save the changes</span>
project<span class="token punctuation">.</span><span class="token function">saveSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/7cb7b1424703489b80a75df1349a4d36" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Generate AST</strong></span><span class="SemanticString">: In this example, we first create a new </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Project</strong></code></span><span class="SemanticString">instance and load a source file using the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">addSourceFileAtPath</strong></code></span><span class="SemanticString">method. </span></span></p></div><div id="https://www.notion.so/06af46f36e3a4aacae39203dd074d7b1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Traverse and Modify</strong></span><span class="SemanticString">: Then we traverse the AST using the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">forEachDescendant</strong></code></span><span class="SemanticString">method and check if each node is a </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">VariableDeclaration</strong></code></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">.</strong></span><span class="SemanticString">If it is, we modify the variable name by appending the string &quot;Modified&quot; to the original name using the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">rename</strong></code></span><span class="SemanticString">method. </span></span></p></div><div id="https://www.notion.so/51f8fc7408fe4bdda8605b0b06930b50" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">OutPut:</strong></span><span class="SemanticString"> Finally, we save the changes using the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">saveSync</strong></code></span><span class="SemanticString">method.</span></span></p></div><h1 id="https://www.notion.so/5be26a3914b54541b14a6a3049522496" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/5be26a3914b54541b14a6a3049522496"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Process Design</span></span></h1><ol class="NumberedListWrapper"><li id="https://www.notion.so/adaabf16ef43454db2d249a862ed05ad" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Scan the changed files.</span></span></li><li id="https://www.notion.so/ede495b23ea943f8b00f86e7376cd118" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">Analyze the changed code in those files.</span></span></li><li id="https://www.notion.so/8eed44a8940b49c68fe432120841c927" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">Scan the files in the project where the changed code is used.</span></span></li><li id="https://www.notion.so/2699cdd5db9f4561956168b6b879b723" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">Analyze the code calls.</span></span></li><li id="https://www.notion.so/63a4b2942d384a93a5999224bab8b093" class="NumberedList" value="5"><span class="SemanticStringArray"><span class="SemanticString">Output the resulting report.</span></span></li></ol><h1 id="https://www.notion.so/4697cfe0367545f5b0f21ca806afbd06" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/4697cfe0367545f5b0f21ca806afbd06"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Implementation Details Of Key Processes</span></span></h1><h2 id="https://www.notion.so/8f50a4171da644c08b36fd15e9f2eb65" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/8f50a4171da644c08b36fd15e9f2eb65"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Get the changed files and the changed codes</span></span></h2><div id="https://www.notion.so/df1a42e5b5af415b82ee010582e8a87a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Git tools can help analyze which files have changed and which lines of code have been modified. </span></span></p></div><div id="https://www.notion.so/951362359e5d4e6a99aff80501510771" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">By analyzing the Abstract Syntax Tree (AST) based on the line number, you can determine the scope of the modified code, analyze the affected exported variables, and count the changed files and corresponding variables.</span></span></p></div><h3 id="https://www.notion.so/d865793058e0401bbdd6827139e306bd" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/d865793058e0401bbdd6827139e306bd"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Code implementation</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/2da310e1b47e4ef7ae44b0d320f1c888" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP1. Use </strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><code class="SemanticString__Fragment SemanticString__Fragment--Code">git status</code></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> to get the changed files.</strong></span></span></li></ul><div id="https://www.notion.so/65e8515ecb5f455cb7fefd76883576a6" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F038e6595-5d57-4675-bb83-4767a41d1e70%2FUntitled.png?width=624&amp;table=block&amp;id=65e8515e-cb5f-455c-b7fe-fd76883576a6"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F038e6595-5d57-4675-bb83-4767a41d1e70%2FUntitled.png?width=624&amp;table=block&amp;id=65e8515e-cb5f-455c-b7fe-fd76883576a6" style="width:624px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/bed2908d856440819cd857f6c218afa0" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdca37f9e-ada9-4caf-bcb2-925b24e3821a%2FUntitled.png?width=642&amp;table=block&amp;id=bed2908d-8564-4081-9cd8-57f6c218afa0"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdca37f9e-ada9-4caf-bcb2-925b24e3821a%2FUntitled.png?width=642&amp;table=block&amp;id=bed2908d-8564-4081-9cd8-57f6c218afa0" style="width:642px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/b18a8908b140494f87f4eee288e22d27" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP2. Use </strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"><code class="SemanticString__Fragment SemanticString__Fragment--Code">git diff</code></strong></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold"> to get the changed code lines (start, end).</strong></span></span></li></ul><div id="https://www.notion.so/8277278f356a4df29e127ab8eac1ee10" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4c0ccda0-0f09-4ff2-8023-9e3ff189297a%2FUntitled.png?width=624&amp;table=block&amp;id=8277278f-356a-4df2-9e12-7ab8eac1ee10"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4c0ccda0-0f09-4ff2-8023-9e3ff189297a%2FUntitled.png?width=624&amp;table=block&amp;id=8277278f-356a-4df2-9e12-7ab8eac1ee10" style="width:624px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/5e7c8c6f374c4c16b2cfe814e6e9a077" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP3. AST traversal, locate the declaration of the code based on the code line, and obtain the target definition.</strong></span></span></li></ul><div id="https://www.notion.so/c988a34411184472b6f3340c0a6a6961" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F98040b03-d289-4995-9829-a86a790d31a7%2FUntitled.png?width=624&amp;table=block&amp;id=c988a344-1118-4472-b6f3-340c0a6a6961"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F98040b03-d289-4995-9829-a86a790d31a7%2FUntitled.png?width=624&amp;table=block&amp;id=c988a344-1118-4472-b6f3-340c0a6a6961" style="width:624px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/3bd1f97f7fc146199a19bf7a55a15c71" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">finally output</span></span></p></div><div id="https://www.notion.so/ab8c384b2ec74d5bb27a90ddc652d4fc" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe3c94777-af56-40e7-8230-3de972001df4%2FUntitled.png?width=720&amp;table=block&amp;id=ab8c384b-2ec7-4d5b-b27a-90ddc652d4fc"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe3c94777-af56-40e7-8230-3de972001df4%2FUntitled.png?width=720&amp;table=block&amp;id=ab8c384b-2ec7-4d5b-b27a-90ddc652d4fc" style="width:720px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><h2 id="https://www.notion.so/367bc30682c3403c899d1391b64fb326" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/367bc30682c3403c899d1391b64fb326"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Scan imports in TypeScript files, match changed files and changed variables.</span></span></h2><div id="https://www.notion.so/948d02be76a840f6a1683ceb0d6c8d55" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">There are various types of references used in our code.</span></span></p></div><div id="https://www.notion.so/de5e7e0f915d47ccb8bce01489b4f737" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To observe some patterns, paste this code into </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://ts-ast-viewer.com/">https://ts-ast-viewer.com/</a></span><span class="SemanticString">.</span></span></p><div class="Text__Children"><pre id="https://www.notion.so/c06105c05cae48f2a5c6857976498e86" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">'../shared'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> foo <span class="token keyword">from</span> <span class="token string">'../shared'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Address<span class="token punctuation">,</span> Person <span class="token keyword">as</span> Person1 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@shared'</span><span class="token punctuation">;</span></span></span></span></code></pre></div></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/2067cad415684872a8783598c9a352c1" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">All referenced places are of the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">importDeclaration</code></span><span class="SemanticString"> node type.</span></span></li><li id="https://www.notion.so/6b249775a9bf430688f67dfe63f4ce65" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">These references include both the file name and exported variables, which we need to match and analyze separately. The file name may have aliases and relative references, while the exported variables may include default exports, namespace exports, named exports, or alias exports.</span></span></li></ul><h3 id="https://www.notion.so/33c20f72e836426787ce6e7ae16e4154" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/33c20f72e836426787ce6e7ae16e4154"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Code implementation</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/ac7a6950556d45bf91bf8bc9703d4ddd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP1.</strong></span><span class="SemanticString"> </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Recursively scan source code files</strong></span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/530fdcc8ab31458d926f6c3b71766ec0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Scan the files under the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">package</strong></code></span><span class="SemanticString"> directory with the following file types: </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">[.js,.ts,.jsx,.tsx]</code></span><span class="SemanticString">, while excluding the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">node_modules</code></span><span class="SemanticString">, </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">__tests__</code></span><span class="SemanticString">, and </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">assets</code></span><span class="SemanticString"> folders.</span></span></li></ul></li><li id="https://www.notion.so/5b607e1cf9974e3e99dc4e5717cdefb3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP2. Check if a reference file is referencing the target file</strong></span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/b66aecda4acd42e0bf0cd656ba04aafb" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Retrieve the import declaration statement for the file.</span></span></li></ul><pre id="https://www.notion.so/1caea752543c48249ab597635b157496" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">const</span> imports <span class="token operator">=</span> sourceFile<span class="token punctuation">.</span><span class="token function">getImportDeclarations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/0b8048a8a6234a67a4716cb5022ed732" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Traverse the statement and retrieve the ModuleSpecifierValue, such as &#x27;../shared&#x27;, &#x27;@shared&#x27;, and &#x27;~/test/shared/index.ts&#x27;.</span></span></li></ul><pre id="https://www.notion.so/8f05b2a3f574450ea98be5233f9b6eaf" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> importDeclaration <span class="token keyword">of</span> imports<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> moduleSpecifier <span class="token operator">=</span> importDeclaration<span class="token punctuation">.</span><span class="token function">getModuleSpecifierValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// ../shared'ï¼Œ'@shared'ï¼Œ'./test/shared/index.ts'       </span>
    <span class="token keyword">const</span> isMatchedFile <span class="token operator">=</span> <span class="token function">isMatchedFilePath</span><span class="token punctuation">(</span>importDeclaration<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/933016bb0bea4f4e99bc14c29aed5f48" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Determine whether the file matches the changed files in the scanned common files.</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/430f5511bc104f6abd60d7bdca9208c7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">We need to determine whether it is an alias reference (</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&#x27;@shared&#x27;,</code></span><span class="SemanticString">), an absolute path reference, or a relative path reference (</span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">&#x27;../shared&#x27;,</code></span><span class="SemanticString">).</span></span></li></ul><div id="https://www.notion.so/cfae79a86f564ad9a5ac83bed51c6650" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feafb9179-981e-4ddc-9cc6-a2cd79a58b13%2FUntitled.png?width=672&amp;table=block&amp;id=cfae79a8-6f56-4ad9-a5ac-83bed51c6650"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Feafb9179-981e-4ddc-9cc6-a2cd79a58b13%2FUntitled.png?width=672&amp;table=block&amp;id=cfae79a8-6f56-4ad9-a5ac-83bed51c6650" style="width:672px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></li></ul></li><li id="https://www.notion.so/90dfb9aaabc64b29b0405baaec0617f4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP3. Get the referenced variables from the referenced file</strong></span></span><div id="https://www.notion.so/a1d8203b4bb8436aae984ad5df37e3a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">For example, we want to retrieve </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">AFunc, BAlias, CFunc, DAlias</strong></span><span class="SemanticString"> from the referenced file. We should also indicate whether each variable is a default export, namespace export, or named export. If there is an alias, we should indicate the original name of the alias.</span></span></p></div><pre id="https://www.notion.so/05a077ce4aa845cba06661989d6f819e" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">import</span> AFunc <span class="token keyword">from</span> <span class="token string">'A-file'</span> <span class="token comment">// DefaultImport</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> BAlias <span class="token keyword">from</span> <span class="token string">'B-file'</span> <span class="token comment">// NamespaceImport</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>CFunc<span class="token punctuation">,</span> DFunc <span class="token keyword">as</span> DAlias <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'B-file'</span> <span class="token comment">// NamedImports</span></span></span></span></code></pre><div id="https://www.notion.so/0522826ac6574559b7369fa62780210b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"> DefaultImport</span></span></p></div><div id="https://www.notion.so/2f5cd57e598e4345a2ea8b515340ccc3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">(The functions of pos and end will be mentioned in the following text)</span></span></p></div><pre id="https://www.notion.so/612b9124fb964ddbb68f1b9550867f61" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">//  getDefaultImport</span>
<span class="token comment">//  import AFunc from 'A-file';</span>
<span class="token keyword">const</span> defaultImport <span class="token operator">=</span> importClause<span class="token punctuation">.</span><span class="token function">getDefaultImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>defaultImport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">handleImports</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">useDefault</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> defaultImport<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// AFunc</span>
        <span class="token literal-property property">pos</span><span class="token operator">:</span> defaultImport<span class="token punctuation">.</span><span class="token function">getPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">end</span><span class="token operator">:</span> defaultImport<span class="token punctuation">.</span><span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/aa854dedb3c44ab19ff0c4e8e6bd7701" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">NamespaceImport</span></span></p></div><pre id="https://www.notion.so/ad78be4cfca7456893630438b0256c17" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">// NamespaceImport</span>
<span class="token comment">// import * as alias from 'A-file';</span>
<span class="token keyword">const</span> namespaceImport <span class="token operator">=</span> importClause<span class="token punctuation">.</span><span class="token function">getNamespaceImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>namespaceImport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleImports</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
       <span class="token literal-property property">useNameSpace</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
       <span class="token literal-property property">name</span><span class="token operator">:</span> namespaceImport<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token literal-property property">pos</span><span class="token operator">:</span> namespaceImport<span class="token punctuation">.</span><span class="token function">getPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token literal-property property">end</span><span class="token operator">:</span> namespaceImport<span class="token punctuation">.</span><span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre><div id="https://www.notion.so/2b95465bab0c457f92677193b76ddc13" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">NamedImports</span></span></p></div><pre id="https://www.notion.so/e473d6184d5d423f9095cc0423e43956" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">// NamespaceImport</span>
<span class="token comment">// import {A, B as b} from 'A-file';</span>
<span class="token keyword">const</span> namedImports <span class="token operator">=</span> importClause<span class="token punctuation">.</span><span class="token function">getNamedImports</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
namedImports<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">namedImport</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
     <span class="token keyword">const</span> nameNode <span class="token operator">=</span> namedImport<span class="token punctuation">.</span><span class="token function">getNameNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">const</span> aliasNode <span class="token operator">=</span> namedImport<span class="token punctuation">.</span><span class="token function">getAliasNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">handleImports</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> aliasNode<span class="token operator">?.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> nameNode<span class="token operator">?.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">originName</span><span class="token operator">:</span> nameNode<span class="token operator">?.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">pos</span><span class="token operator">:</span> namedImport<span class="token punctuation">.</span><span class="token function">getPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">end</span><span class="token operator">:</span> namedImport<span class="token punctuation">.</span><span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/137253c4c87f4f1d966882824c229562" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP4. Check if the node hits the change Node of changeFiles and output the result.</strong></span></span></li></ul><pre id="https://www.notion.so/8b1fca346cbc4a2786e3c33c620c4540" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">this</span><span class="token punctuation">.</span>changedFiles<span class="token operator">?.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">changedFile</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>changedFile<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>importPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">const</span> changedNodes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>changedFilesNodes<span class="token operator">?.</span><span class="token punctuation">[</span>changedFile<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>changedNodes<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>originName <span class="token operator">||</span> item<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">_addItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/8e9254e6d12b468080197e095c8f0111" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F57c6bbbd-2429-4e06-b812-732d6aaecfda%2FUntitled.png?width=912&amp;table=block&amp;id=8e9254e6-d12b-4680-8019-7e095c8f0111"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F57c6bbbd-2429-4e06-b812-732d6aaecfda%2FUntitled.png?width=912&amp;table=block&amp;id=8e9254e6-d12b-4680-8019-7e095c8f0111" style="width:912px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></li></ul><h2 id="https://www.notion.so/01d35486256646d5bbe566714c8bdbd1" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/01d35486256646d5bbe566714c8bdbd1"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Analysis of code used</span></span></h2><div id="https://www.notion.so/696c85282065425baead4de909ce689c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">We aim to analyze the usage of collected variables in a file. How can we design a strategy for this? Let&#x27;s take a look at the following code snippet.</span></span></p></div><div id="https://www.notion.so/ccffa44b225941cf8fc661fba903d4c4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Copy the code and paste it into </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://ts-ast-viewer.com/">https://ts-ast-viewer.com/</a></span><span class="SemanticString">.</span></span></p><div class="Text__Children"><pre id="https://www.notion.so/688e9a619f204457856ee80c04561f6c" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">import</span> <span class="token punctuation">{</span> Foo<span class="token punctuation">,</span> Bar <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./types"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> baz <span class="token keyword">from</span> <span class="token string">"./baz"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">foo</span><span class="token operator">:</span> Foo<span class="token punctuation">,</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> Bar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">qux</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token operator">+</span> bar<span class="token punctuation">.</span>baz<span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">qux</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">foo</span><span class="token operator">:</span> Foo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> foo <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token literal-property property">myFoo</span><span class="token operator">:</span> Foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token literal-property property">myBar</span><span class="token operator">:</span> Bar <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">baz</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">baz</span><span class="token punctuation">(</span>myFoo<span class="token punctuation">,</span> myBar<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre></div></div><div id="https://www.notion.so/4f22c4923e9947a58c3fe4f4f8ca87a5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">  There are two key points to consider:</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/315b74c8858c40caae1266dd121fb182" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">All references are called through identifiers.</span></span></li><li id="https://www.notion.so/6879a572125a41919e2742193d4bee62" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">To distinguish whether it is the same identifier reference or a local variable with the same name, we can identify it using the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pos</code></span><span class="SemanticString"> of the identifier&#x27;s symbol&#x27;s </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">declarations</code></span><span class="SemanticString">. As shown in the figure below, the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pos</code></span><span class="SemanticString"> and </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">end</code></span><span class="SemanticString"> of the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">declarations</code></span><span class="SemanticString"> of symbols with the same reference are the same.</span></span></li></ol><div id="https://www.notion.so/060da72be3124c4782455af34ed4cf48" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">the pos of identifier from import</em></span></span></p></div><div id="https://www.notion.so/95c2fee285b0441aa201e231090b225f" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb6a3c545-02c7-4caa-a6db-b3132fca5849%2FUntitled.png?width=960&amp;table=block&amp;id=95c2fee2-85b0-441a-a201-e231090b225f"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fb6a3c545-02c7-4caa-a6db-b3132fca5849%2FUntitled.png?width=960&amp;table=block&amp;id=95c2fee2-85b0-441a-a201-e231090b225f" style="width:960px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/2b627f345fd446b998882f54e046ba7b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">a local variable with the same name, has different </em></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">pos</em></code></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"> and </em></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">end</em></code></span></span></p></div><div id="https://www.notion.so/0e6c164d9ffa4895acc112e65bebfdb1" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4a021c3d-46cb-4ae5-9d5d-da7937dfcc31%2FUntitled.png?width=960&amp;table=block&amp;id=0e6c164d-9ffa-4895-acc1-12e65bebfdb1"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4a021c3d-46cb-4ae5-9d5d-da7937dfcc31%2FUntitled.png?width=960&amp;table=block&amp;id=0e6c164d-9ffa-4895-acc1-12e65bebfdb1" style="width:960px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/85c2f9928a924028bd71b21ecdbc78b7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">the references of identifier from import, The </em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><code class="SemanticString__Fragment SemanticString__Fragment--Code">pos</code></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"> and </em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><code class="SemanticString__Fragment SemanticString__Fragment--Code">end</code></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"> of the </em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"><code class="SemanticString__Fragment SemanticString__Fragment--Code">declarations</code></em></span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic"> of a symbol are the same as the references of the identifier.</em></span></span></p></div><div id="https://www.notion.so/661fa7c0329847df982250498e15604b" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdd239829-eb68-42a1-ad40-a18cfec67ac4%2FUntitled.png?width=1008&amp;table=block&amp;id=661fa7c0-3298-47df-9822-50498e15604b"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fdd239829-eb68-42a1-ad40-a18cfec67ac4%2FUntitled.png?width=1008&amp;table=block&amp;id=661fa7c0-3298-47df-9822-50498e15604b" style="width:1008px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/759f58eae0964af888440f593fac1fdd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h3 id="https://www.notion.so/769a657a46fa49f38c4858e3e6f7bed0" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/769a657a46fa49f38c4858e3e6f7bed0"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Code implementation</span></span></h3><div id="https://www.notion.so/e7560153d39c4f008616f29a2b3d9612" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP1. Traverse the AST nodes of the target source file</strong></span></span></p><div class="Text__Children"><div id="https://www.notion.so/c3be803b2e114daab3cfb14f0b6d2127" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">use  </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">forEachDescendant</code></span></span></p></div><pre id="https://www.notion.so/1a134f9e905547f8b145ed19021a53b1" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>sourceFile<span class="token punctuation">.</span><span class="token function">forEachDescendant</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
		<span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></span></span></span></code></pre></div></div><div id="https://www.notion.so/fd059259dcad42d39236014b12a02ee3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP2. Get all Identifier nodes</strong></span></span></p><div class="Text__Children"><pre id="https://www.notion.so/1cff8c863a4c48f3bd5c1ac5700b8f10" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">getKind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> SyntaxKind<span class="token punctuation">.</span>Identifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	 <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></span></span></span></code></pre></div></div><div id="https://www.notion.so/3bdf4332c9dd4e479e3315c3759d5001" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/40928ae2f1604bb69e998f566f915d14" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP3. Check if the text name of the node matches the text name of the reference node</strong></span></span></p><div class="Text__Children"><pre id="https://www.notion.so/fd36e5c82ec5484280df319e845e2181" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">const</span> name <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> matchImportItem <span class="token operator">=</span> importItems<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matchImportItem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></span></span></code></pre></div></div><div id="https://www.notion.so/b4a0f68bfa37459fbe1781e9eee6b133" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/90d58802903640369d208e430ad300ce" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP4. Exclude local variables with the same name that could cause interference</strong></span></span></p><div class="Text__Children"><pre id="https://www.notion.so/34e1795058bb48d6b9077741fba10ff5" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">const</span> symbol <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getSymbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>symbol<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> symbolDeclarations <span class="token operator">=</span> symbol<span class="token punctuation">.</span><span class="token function">getDeclarations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>symbolDeclarations <span class="token operator">&amp;&amp;</span> symbolDeclarations<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> symbolPos <span class="token operator">=</span> symbolDeclarations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getPos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> symbolEnd <span class="token operator">=</span> symbolDeclarations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// Identifier symbol.declarations pos and end must be equal to importItem symbol.declarations pos and end</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token comment">// exclude the reference from importItem</span>
            matchImportItem<span class="token punctuation">.</span>symbolPos <span class="token operator">!==</span> symbolPos <span class="token operator">&amp;&amp;</span>
            <span class="token comment">// exclude local variable with the same name</span>
            matchImportItem<span class="token punctuation">.</span>pos <span class="token operator">==</span> symbolPos <span class="token operator">&amp;&amp;</span>
            matchImportItem<span class="token punctuation">.</span>end <span class="token operator">==</span> symbolEnd
          <span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
          <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></span></span></span></code></pre></div></div><div id="https://www.notion.so/32159694ac164bbcb102de5d303ca7d5" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">STEP5.Count the lines where the code is called and output the result as statistics.</strong></span></span></p><div class="Text__Children"><pre id="https://www.notion.so/f63f67b5927b465689f3ca9ceb40b6e4" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">const</span> line <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">getStartLineNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
importItemMap<span class="token punctuation">[</span>filePath<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">?.</span>callLines<span class="token operator">?.</span><span class="token function">push</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre><div id="https://www.notion.so/07e9a7624257459cb1b16a162658259a" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4264b346-8bc0-4045-823b-678d8094dcfc%2FUntitled.png?width=672&amp;table=block&amp;id=07e9a762-4257-459c-b1b1-6a162658259a"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4264b346-8bc0-4045-823b-678d8094dcfc%2FUntitled.png?width=672&amp;table=block&amp;id=07e9a762-4257-459c-b1b1-6a162658259a" style="width:672px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></div></div><h1 id="https://www.notion.so/e11b44fd671e406ea8439641426fdb31" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/e11b44fd671e406ea8439641426fdb31"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Further optimization</span></span></h1><ul class="BulletedListWrapper"><li id="https://www.notion.so/6d1bd4b43b164d16b8621193a3664130" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Improve the matching of export code changes to cover more edge cases and achieve greater accuracy.</span></span></li><li id="https://www.notion.so/0bb1079865cd46f5be6c9aed7131db53" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Conduct further analysis of the affected code to determine impact priorities. For example, prioritize function calls with high impact and type calls with low impact.</span></span></li><li id="https://www.notion.so/0bbcd9e124c2462a80b40ca84101b58f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Visualize the results or create a VSCode plugin.</span></span></li></ul><div id="https://www.notion.so/c9c83e6a9fed48eaa055e88db5075833" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div></article>
  <footer class="Footer">
  <!-- <div>&copy; Lilian Jiangâ€™s Blog</div> -->
  <!-- <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div> -->
</footer>
</body>
<script src="https://utteranc.es/client.js" repo="JLraining/JLraining.github.io"
  issue-term="pathname" theme="github-light" crossorigin="anonymous" async>
</script>

</html>